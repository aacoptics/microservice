<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aacoptics.wlg.equipment.mapper.MaintenanceOrderMapper">

    <select id="findMaintenanceList" resultType="com.aacoptics.wlg.equipment.entity.po.MaintenanceMain">
        SELECT A.*
            FROM EM_MAINTENANCE_MAIN A
            WHERE EXISTS(SELECT 1 FROM EM_MAINTENANCE_ITEM B WHERE A.ID = B.MAINTENANCE_MAIN_ID)
           ORDER BY A.ID, A.MCH_NAME, A.SPEC, A.TYPE_VERSION
    </select>

    <select id="findMaintenanceOrderList" resultType="com.aacoptics.wlg.equipment.entity.vo.MaintenanceOrderVO">
            SELECT A.ID,
                   A.ORDER_NUMBER,
                   A.MCH_CODE,
                   A.MAINTENANCE_DATE,
                   A.MAINTENANCE_PERIOD,
                   A.PERIOD_UNIT,
                   A.DUTY_PERSON_ID,
                   A.STATUS,
                   A.CREATED_TIME,
                   A.CREATED_BY,
                   A.UPDATED_TIME,
                   A.UPDATED_BY,
                   B.MCH_NAME,
                   B.SPEC,
                   B.TYPE_VERSION,
                   B.FACTORY_NO
            FROM EM_MAINTENANCE_ORDER A
                     LEFT JOIN EM_EQUIPMENT B ON A.MCH_CODE = B.MCH_CODE
            WHERE 1=1
            <if test="maintenanceOrderQueryParam.mchCode != null and maintenanceOrderQueryParam.mchCode!=''">
                AND A.MCH_CODE = #{maintenanceOrderQueryParam.mchCode}
            </if>
            <if test="maintenanceOrderQueryParam.status != null and maintenanceOrderQueryParam.status!=''">
                AND A.STATUS = #{maintenanceOrderQueryParam.status}
            </if>
            <if test="maintenanceOrderQueryParam.mchName != null and maintenanceOrderQueryParam.mchName!=''">
                AND B.MCH_NAME = #{maintenanceOrderQueryParam.mchName}
            </if>
            <if test="maintenanceOrderQueryParam.spec != null and maintenanceOrderQueryParam.spec!=''">
                AND B.SPEC = #{maintenanceOrderQueryParam.spec}
            </if>
            <if test="maintenanceOrderQueryParam.typeVersion != null and maintenanceOrderQueryParam.typeVersion!=''">
                AND B.TYPE_VERSION = #{maintenanceOrderQueryParam.typeVersion}
            </if>
             ORDER BY A.ORDER_NUMBER
    </select>


    <select id="findOrderByMchCode" resultType="com.aacoptics.wlg.equipment.entity.vo.MaintenanceOrderAndItemVO">
        SELECT TOP 1 A.ID,
        A.ORDER_NUMBER,
        A.MCH_CODE,
        A.MAINTENANCE_DATE,
        A.MAINTENANCE_PERIOD,
        A.PERIOD_UNIT,
        A.DUTY_PERSON_ID,
        A.STATUS,
        A.CREATED_TIME,
        A.CREATED_BY,
        A.UPDATED_TIME,
        A.UPDATED_BY,
        B.MCH_NAME,
        B.SPEC,
        B.TYPE_VERSION,
        B.FACTORY_NO
        FROM EM_MAINTENANCE_ORDER A
        LEFT JOIN EM_EQUIPMENT B ON A.MCH_CODE = B.MCH_CODE
        WHERE 1=1
        AND A.MCH_CODE = #{mchCode}
        AND A.STATUS IN ('0', '1')
        ORDER BY A.MAINTENANCE_DATE
    </select>

</mapper>
