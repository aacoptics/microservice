<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aacoptics.temphumidity.mapper.TemphumidityMapper">
    <select id="getTemphumidityInfoByDate" parameterType="java.lang.String" resultType="com.aacoptics.temphumidity.entity.TemphumidityInfo">
        select JSON_VALUE(data_str, '$.Sensor_number') as sensorNumber, JSON_VALUE(data_str, '$.__time') as time, JSON_VALUE(data_str, '$.receive_date') as receiveDate,
        JSON_VALUE(data_str, '$.dev_template_unique_id') as devTemplateUniqueId, JSON_VALUE(data_str, '$.device_id') as deviceId,
        JSON_VALUE(data_str, '$.that_moment_program_version_id') as thatMomentProgramVersionId, JSON_VALUE(data_str, '$.temperature') as temperature,
        JSON_VALUE(data_str, '$.humidity') as humidity, JSON_VALUE(data_str, '$.data_col_time') as dataColTime, JSON_VALUE(data_str, '$.client_id') as clientId,
        JSON_VALUE(data_str, '$.CncStatus') as cncStatus from device_original_data where data_date_str = #{date} and dev_id in (select dev_id from device_mapping where device_name like '温湿度%')
    </select>

    <select id="getSmartMeterInfoByDate" parameterType="java.lang.String" resultType="com.aacoptics.temphumidity.entity.SmartMeterInfo">
        select JSON_VALUE(data_str, '$.device_id') as deviceId, JSON_VALUE(data_str, '$.__time') as time, JSON_VALUE(data_str, '$.receive_date') as receiveDate,
        JSON_VALUE(data_str, '$.dev_template_unique_id') as devTemplateUniqueId, JSON_VALUE(data_str, '$.that_moment_program_version_id') as thatMomentProgramVersionId,
        JSON_VALUE(data_str, '$.program_version') as programVersion, JSON_VALUE(data_str, '$.client_id') as clientId, JSON_VALUE(data_str, '$.data_col_time') as dataColTime,
        JSON_VALUE(data_str, '$.CncStatus') as cncStatus, JSON_VALUE(data_str, '$.Uan') as uan, JSON_VALUE(data_str, '$.Ubn') as ubn,
        JSON_VALUE(data_str, '$.Ucn') as ucn, JSON_VALUE(data_str, '$.Uab') as uab, JSON_VALUE(data_str, '$.Ubc') as ubc, JSON_VALUE(data_str, '$.Uca') as uca,
        JSON_VALUE(data_str, '$.Ia') as ia, JSON_VALUE(data_str, '$.Ib') as ib, JSON_VALUE(data_str, '$.Ic') as ic,
        JSON_VALUE(data_str, '$.Pa') as pa, JSON_VALUE(data_str, '$.Pb') as pb, JSON_VALUE(data_str, '$.Pc') as pc, JSON_VALUE(data_str, '$.Ptotal') as pTotal,
        JSON_VALUE(data_str, '$.Qa') as qa, JSON_VALUE(data_str, '$.Qb') as qb, JSON_VALUE(data_str, '$.Qc') as qc, JSON_VALUE(data_str, '$.Qtotal') as qTotal,
        JSON_VALUE(data_str, '$.Sa') as sa, JSON_VALUE(data_str, '$.Sb') as sb, JSON_VALUE(data_str, '$.Sc') as sc, JSON_VALUE(data_str, '$.Stotal') as sTotal,
        JSON_VALUE(data_str, '$.Fa') as fa, JSON_VALUE(data_str, '$.Fb') as fb, JSON_VALUE(data_str, '$.Fc') as fc, JSON_VALUE(data_str, '$.Ftotal') as fTotal,
        JSON_VALUE(data_str, '$.EPI') as epi, JSON_VALUE(data_str, '$.EPE') as epe, JSON_VALUE(data_str, '$.EQL') as eql, JSON_VALUE(data_str, '$.EQC') as eqc,
        JSON_VALUE(data_str, '$.Current_tr') as currentTr, JSON_VALUE(data_str, '$.Voltage_tr') as voltageTr from device_original_data where data_date_str = #{date} and dev_id in (select dev_id from device_mapping where device_name like '智能电表%')
    </select>
</mapper>